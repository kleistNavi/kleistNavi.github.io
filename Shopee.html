
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>ç”¢å“å®šåƒ¹è¨ˆç®—å™¨</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.3.1/css/bootstrap.min.css">
</head>

<body>
    <style>
        .number {
            font-family: menlo, 'Courier New',system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
    <div class="container mt-5">
        <h1 class="text-center mb-5">ç”¢å“å®šåƒ¹è¨ˆç®—å™¨</h1>
        <form>
            <div class="form-group row">
                <label for="length" class="col-sm-2 col-form-label text-right">é•·åº¦ï¼ˆå˜ç±³ï¼‰ï¼š</label>
                <div class="col-sm-2">
                    <input type="text" id="length" class="form-control" required>
                </div>
                <label for="width" class="col-sm-2 col-form-label text-right">å¯¬åº¦ï¼ˆå˜ç±³ï¼‰ï¼š</label>
                <div class="col-sm-2">
                    <input type="text" id="width" class="form-control" required>
                </div>
                <label for="height" class="col-sm-2 col-form-label text-right">é«˜åº¦ï¼ˆå˜ç±³ï¼‰ï¼š</label>
                <div class="col-sm-2">
                    <input type="text" id="height" class="form-control" required>
                </div>
            </div>
            <div class="form-group row">
                <label for="weight" class="col-sm-2 col-form-label text-right">é‡é‡ï¼ˆåƒå…‹ï¼‰ï¼š</label>
                <div class="col-sm-2">
                    <input type="text" id="weight" class="form-control" required>
                </div>
                <label for="cost" class="col-sm-2 col-form-label text-right">é€²åƒ¹æˆæœ¬ï¼ˆRMBï¼‰ï¼š</label>
                <div class="col-sm-2">
                    <input type="text" id="cost" class="form-control" required>
                </div>
                <label for="liry" class="col-sm-2 col-form-label text-right">åˆ©æ¶¦ç‡ï¼š</label>
                <div class="col-sm-2">
                    <input type="text" id="liry" class="form-control" value="50" required>
                </div>
            </div>
            <div class="form-group row">
                <label for="threshold1" class="col-sm-2 col-form-label text-right">é–€æª»1ï¼ˆTWDï¼‰ï¼š</label>
                <div class="col-sm-2">
                    <input type="text" id="threshold1" class="form-control" value="299" required>
                </div>
                <label for="discount1" class="col-sm-2 col-form-label text-right">æ»¿æ¸›1ï¼ˆTWDï¼‰ï¼š</label>
                <div class="col-sm-2">
                    <input type="text" id="discount1" class="form-control" value="10" required>
                </div>
                <label for="vekzlv" class="col-sm-2 col-form-label text-right">æŠ˜æ‰£ç‡ï¼š</label>
                <div class="col-sm-2">
                    <input type="text" id="vekzlv" class="form-control" value="35" required>
                </div>
            </div>
            <div class="form-group row">
                <label for="threshold2" class="col-sm-2 col-form-label text-right">é–€æª»2ï¼ˆTWDï¼‰ï¼š</label>
                <div class="col-sm-2">
                    <input type="text" id="threshold2" class="form-control" value="499" required>
                </div>
                <label for="discount2" class="col-sm-2 col-form-label text-right">æ»¿æ¸›2ï¼ˆTWDï¼‰ï¼š</label>
                <div class="col-sm-2">
                    <input type="text" id="discount2" class="form-control" value="20" required>
                </div>
            </div>
            <div class="form-group row">
                <label for="threshold3" class="col-sm-2 col-form-label text-right">é–€æª»3ï¼ˆTWDï¼‰ï¼š</label>
                <div class="col-sm-2">
                    <input type="text" id="threshold3" class="form-control" value="899" required>
                </div>
                <label for="discount3" class="col-sm-2 col-form-label text-right">æ»¿æ¸›3ï¼ˆTWDï¼‰ï¼š</label>
                <div class="col-sm-2">
                    <input type="text" id="discount3" class="form-control" value="35" required>
                </div>
            </div>
            <div class="form-group row">
                <label for="threshold4" class="col-sm-2 col-form-label text-right">é–€æª»4ï¼ˆTWDï¼‰ï¼š</label>
                <div class="col-sm-2">
                    <input type="text" id="threshold4" class="form-control" value="1299" required>
                </div>
                <label for="discount4" class="col-sm-2 col-form-label text-right">æ»¿æ¸›4ï¼ˆTWDï¼‰ï¼š</label>
                <div class="col-sm-2">
                    <input type="text" id="discount4" class="form-control" value="50" required>
                </div>
            </div>
            <div class="form-group row">
                <div class="col-sm-2"></div>
                <div class="col-sm-10">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" checked='checked' id="noTransportationFee"
                            name="transportationFee" value="noTransportationFee">
                        <label class="form-check-label" for="noTransportationFee">å…è¿æ‰‹ç»­è´¹ 5%</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" checked='checked' id="transactionFee"
                            name="transactionFee" value="transactionFee">
                        <label class="form-check-label" for="transactionFee">æˆäº¤æ‰‹ç»­è´¹ 5.5%</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" checked='checked' id="paymentServiceFee"
                            name="paymentServiceFee" value="paymentServiceFee">
                        <label class="form-check-label" for="paymentServiceFee">é‡‘æµæœåŠ¡è´¹ 2%</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" checked='checked' id="taxFee" name="taxFee"
                            value="taxFee">
                        <label class="form-check-label" for="paymentServiceFee">ç¨…é‡‘è´¹ç”¨ 5%</label>
                    </div>
                </div>
            </div>

            <div class="form-group text-center">
                <button type="button" class="btn btn-success" onclick="calculate()">è¨ˆç®—</button>
            </div>

        </form>
        <div class="card mt-5">
            <div class="card-header">
                <h2 class="text-center">è¨ˆç®—çµæœ</h2>
            </div>
            <div class="row number">
                <div class="col">
                </div>
                <div class="col">
                    <p>å¹³å°è²»ç”¨ğŸŸ¥ï¼š <span id="platformFee"></span></p>
                    <p>ç¸½è¨ˆæˆæœ¬ğŸŸ¥ï¼š <span id="finalCost"></span></p>
                    <p>é‹è¼¸æˆæœ¬ğŸŸ¥ï¼š <span id="transportationCost"></span></p>
                    <p>æ»¿æ¸›å„ªæƒ ğŸŸ¦ï¼š <span id="discountPercent"></span></p>
                </div>
                <div class="col">
                    <p>å®šåƒ¹RMBğŸŸ¥ï¼š <span id="sellingPrice"></span></p>
                    <p>å®šåƒ¹TWDğŸŸ¦ï¼š <span id="finalSellingPrice_vekzqm"></span></p>
                    <p>å”®åƒ¹TWDğŸŸ¦ï¼š <span id="finalPrice"></span></p>
                    <p>æœ€çµ‚åˆ©ç‡ğŸ”£ï¼š <span id="finalProfit"></span></p>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script>
            const API_KEY = "91adc9ba5e602a3e482c8c0e"; // æ›¿æ›ç‚ºä½ çš„API KEY
            function calculate() {
                // è·å–è¾“å…¥æ¡†ä¸­çš„å€¼
                const length = document.getElementById("length").value;
                const width = document.getElementById("width").value;
                const height = document.getElementById("height").value;
                const liry = document.getElementById("liry").value;
                const weight = document.getElementById("weight").value;
                const cost = document.getElementById("cost").value;
                const vekzlv = document.getElementById("vekzlv").value;   //æŠ˜æ‰£ç‡

                // è·å–å¤é€‰æ¡†ä¸­çš„å€¼
                const noTransportationFee = document.getElementById("noTransportationFee").checked;
                const transactionFee = document.getElementById("transactionFee").checked;
                const paymentServiceFee = document.getElementById("paymentServiceFee").checked;
                const taxFee = document.getElementById("taxFee").checked;

                // è·å–æ»¡å‡é—¨æ§›å’Œæ»¡å‡åŠ›åº¦
                const threshold1 = document.getElementById("threshold1").value;
                const threshold2 = document.getElementById("threshold2").value;
                const threshold3 = document.getElementById("threshold3").value;
                const threshold4 = document.getElementById("threshold4").value;
                const discount1 = document.getElementById("discount1").value;
                const discount2 = document.getElementById("discount2").value;
                const discount3 = document.getElementById("discount3").value;
                const discount4 = document.getElementById("discount4").value;

                // è°ƒç”¨APIè·å–æ±‡ç‡
                axios.get(`https://v6.exchangerate-api.com/v6/${API_KEY}/latest/CNY`)
                    .then(response => {
                        const exchangeRate = response.data.conversion_rates.TWD;
                        // console.log(exchangeRate);

                        let fwlv = 0;
                        if (noTransportationFee) {
                            fwlv += 0.05; // å…è¿æ‰‹ç»­è´¹
                        }

                        if (transactionFee) {
                            fwlv += 0.055; // æˆäº¤æ‰‹ç»­è´¹
                        }

                        if (paymentServiceFee) {
                            fwlv += 0.02; // é‡‘æµæœåŠ¡è´¹
                        }

                        if (taxFee) {
                            fwlv += 0.04; // ç¨…é‡‘è´¹
                        }
                        // console.log(fwlv);
                        // ä½¿ç”¨ç°æœ‰å…¬å¼è®¡ç®—ç›¸å…³è´¹ç”¨å’Œä»·æ ¼
                        let transportationCost = ((parseInt(length) * parseInt(width) * parseInt(height) / 6000) + parseInt(weight)) / 2 * 7.5; // è¿è¾“è´¹ç”¨  
                        let finalCost = transportationCost + parseInt(cost); // æ€»æˆæœ¬ = æˆæœ¬+é‹è²»
                        let sellingPrice = finalCost / (1 - liry/100 - fwlv); // æŠ˜æ‰£å‰å”®ä»·ï¼šå”®åƒ¹ = ç¸½æˆæœ¬/(1-åˆ©æ½¤ç‡-ä½£é‡‘ç‡)
                        // console.log(sellingPrice);
                        let platformFee = sellingPrice * fwlv; // å¹³å°è´¹ç”¨ = å”®åƒ¹ * ä½£é‡‘ç‡
                        // let finalPrice = sellingPrice; // æŠ˜æ‰£å‰å”®ä»·

                        // let finalProfit = sellingPrice * liry / 100;

                        // è®¡ç®—æ»¡å‡æŠ˜æ‰£
                        let thresholdArray = [parseInt(threshold1), parseInt(threshold2), parseInt(threshold3),parseInt(threshold4)];
                        let discountArray = [parseInt(discount1), parseInt(discount2), parseInt(discount3), parseInt(discount4)];
                        let discountPercent = 0;
                        // let finalProfit = 0;
                        for (let i = 0; i < thresholdArray.length; i++) {
                            if ((sellingPrice * exchangeRate) >= thresholdArray[i]) {
                                discountPercent = discountArray[i];
                            }
                        }
                        let finalPrice = sellingPrice * exchangeRate + discountPercent;

                        // finalProfit = finalCost / (sellingPrice + discountPercent/exchangeRate - finalCost) * 100;
                        finalProfit = (finalPrice - finalCost * exchangeRate - discountPercent - platformFee * exchangeRate) / (finalPrice) * 100;
                        console.log(finalPrice - finalCost * exchangeRate - discountPercent - platformFee * exchangeRate)/exchangeRate;
                                        // ï¼ˆæœ€çµ‚å”®åƒ¹ - ç¸½è¨ˆæˆæœ¬è‡ºå¹£ - æ»¿æ¸›å„ªæƒ  - å¹³è‡ºè²»ç”¨ï¼‰/æœ€çµ‚å”®åƒ¹è‡ºå¹£
                        const finalSellingPrice = sellingPrice * (100 - discountPercent) / 100 + platformFee; // æœ€ç»ˆå”®ä»·

                        console.log(finalSellingPrice);
                        finalSellingPrice_vekzqm = finalPrice / (vekzlv / 100);
                        sellingPrice = finalPrice / exchangeRate;
                        // å±•ç¤ºè®¡ç®—ç»“æœ
                        document.getElementById("transportationCost").innerText = "ï¿¥" + transportationCost.toFixed(1);   // é‹è²»
                        document.getElementById("platformFee").innerText = "ï¿¥" + platformFee.toFixed(2);                 // å¹³å°è²»
                        document.getElementById("finalCost").innerText = "ï¿¥" + finalCost.toFixed(2);                     // ç¸½è¨ˆæˆæœ¬
                        document.getElementById("finalPrice").innerText = "ï¿¥" + finalPrice.toFixed(0);                   // æœ€çµ‚å”®åƒ¹ TWD
                        document.getElementById("discountPercent").innerText = "ï¿¥" + discountPercent.toFixed(0);         // æ¸›å…è²»ç”¨
                        document.getElementById("finalProfit").innerText = finalProfit.toFixed(2) + "%";                  // æœ€çµ‚åˆ©ç‡
                        document.getElementById("sellingPrice").innerText = "ï¿¥" + finalSellingPrice.toFixed(0);          // å”®åƒ¹
                        document.getElementById("finalSellingPrice_vekzqm").innerText = "ï¿¥" + finalSellingPrice_vekzqm.toFixed(0);          // å”®åƒ¹
                    })
                    .catch(error => {
                        console.log(error);
                        alert("ç²å–åŒ¯ç‡å¤±æ•—ï¼Œè«‹åˆ·æ–°é é¢é‡è©¦ã€‚");
                    });
            }
        </script>
</body>

</html>